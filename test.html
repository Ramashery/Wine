<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Тест активации Админ-панели</title>
    <script type="module" src="firebase-init.js"></script>
    <style>
        body { font-family: sans-serif; background: #2c2c2c; color: #f0f0f0; padding: 20px; }
        #status-log { border: 1px solid #555; padding: 15px; margin-bottom: 20px; background: #333; border-radius: 8px; }
        .log-entry { margin-bottom: 8px; }
        .success { color: #73d173; }
        .error { color: #ff6b6b; font-weight: bold; }
        .info { color: #6badd8; }
        footer { padding: 20px; background: #1e1e1e; border: 2px dashed #c19a6b; cursor: pointer; text-align: center; }
        #admin-panel { padding: 20px; background: #444; border: 1px solid #666; }
    </style>
</head>
<body>

    <h1>Тест активации Админ-панели</h1>
    <div id="status-log">
        <p><strong>Лог проверки:</strong></p>
    </div>

    <div id="main-site-content">
        <p>Это контент основного сайта.</p>
    </div>

    <div id="admin-panel" style="display: none;">
        <h2>Админ-панель</h2>
        <p class="success">Если вы видите этот текст, значит админ-панель успешно открылась!</p>
    </div>

    <footer id="footer">
        <h3>Это футер. Сделайте по мне двойной клик, чтобы открыть админ-панель.</h3>
    </footer>

    <script type="module">
        const logContainer = document.getElementById('status-log');

        function log(message, type = 'info') {
            const p = document.createElement('p');
            p.className = `log-entry ${type}`;
            p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(p);
            console.log(message);
        }

        log('Тестовый скрипт запущен.');

        try {
            // ШАГ 1: Проверяем, можем ли мы импортировать 'db' из firebase-init.js
            const { db } = await import('./firebase-init.js');
            log('УСПЕХ: Модуль Firebase и объект `db` успешно импортированы.', 'success');

            // ШАГ 2: Ждем загрузки DOM и ищем нужные элементы
            document.addEventListener('DOMContentLoaded', () => {
                log('Событие DOMContentLoaded сработало.');

                const footer = document.getElementById('footer');
                const adminPanel = document.getElementById('admin-panel');
                const mainSiteContent = document.getElementById('main-site-content');

                if (footer && adminPanel && mainSiteContent) {
                    log('УСПЕХ: Все необходимые элементы (footer, admin-panel, main-site-content) найдены на странице.', 'success');
                } else {
                    log('ОШИБКА: Один или несколько ключевых HTML-элементов не найдены! Проверьте ID.', 'error');
                    return; // Прерываем выполнение, если нет элементов
                }

                // ШАГ 3: Прикрепляем обработчик клика к футеру
                let clickCount = 0;
                let clickTimer = null;

                footer.addEventListener('click', () => {
                    log(`Клик по футеру! Текущий счетчик: ${clickCount + 1}`);
                    clickCount++;

                    if (clickCount === 1) {
                        log('Первый клик зарегистрирован. Запускаю таймер на 400мс...');
                        clickTimer = setTimeout(() => {
                            log('Таймер истек. Счетчик сброшен.');
                            clickCount = 0;
                        }, 400);
                    } else if (clickCount === 2) {
                        log('Второй клик зарегистрирован! Отменяю таймер и вызываю enterAdminMode().', 'success');
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        enterAdminMode();
                    }
                });
                log('Обработчик двойного клика успешно прикреплен к футеру.', 'success');
                log('Теперь сделайте двойной клик по футеру внизу страницы.');

                function enterAdminMode() {
                    log('Функция enterAdminMode() вызвана!');
                    mainSiteContent.style.display = 'none';
                    adminPanel.style.display = 'block';
                    log('УСПЕХ: Админ-панель должна быть видна!', 'success');
                }
            });

        } catch (e) {
            // Если импорт не удался, это самая первая и главная ошибка
            log('КРИТИЧЕСКАЯ ОШИБКА: Не удалось импортировать `db` из firebase-init.js.', 'error');
            log(`Текст ошибки: ${e.message}`, 'error');
            log('Проверьте, что файл firebase-init.js существует, в нем нет синтаксических ошибок и ваш `firebaseConfig` правильный.', 'error');
        }
    </script>

</body>
</html>